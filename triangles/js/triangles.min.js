/**

The MIT License (MIT)

Copyright (c) 2014 Maksim Surguy

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

**/function rgbToHex(e,t,i){return"#"+((1<<24)+(e<<16)+(t<<8)+i).toString(16).slice(1)}function getTriangleColor(e,t,i){if(this&&img.loaded){i.width*-.5,.5*i.height;var n=e[0]+(t[1]-t[0])/2,r=e[1]+(t[3]-t[2])/2,o=Math.floor(img.canvas.width*(n/(t[1]-t[0]))),s=Math.floor(img.canvas.height*(r/(t[3]-t[2]))),a=img.context.getImageData(o,s,1,1).data,l=new FSS.Color(rgbToHex(a[0],a[1],a[2]),1);return l}var l=new FSS.Color(rgbToHex(0,0,0),1);return l}function updateGradient(e){var t=svg.defs.selectAll("linearGradient").data(e,function(e){return e.id});t.exit().remove(),t.enter().append("linearGradient").attr("id",function(e){return e.id}).attr("gradientUnits","userSpaceOnUse").selectAll("stop").data(function(e){return e.stops}).enter().append("stop"),t.attr("x1",function(e){return e.box.x}).attr("y1",function(e){return e.box.y}).attr("x2",function(e){return e.box.x+e.box.width}).attr("y2",function(e){return e.box.y+e.box.height}).selectAll("stop").attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color})}function createGradientDef(e,t,i,n){var r="gd"+e;return{id:r,box:n,stops:[{offset:"0%",color:"rgb("+t[0]+","+t[1]+","+t[2]+")"},{offset:"100%",color:"rgb("+i[0]+","+i[1]+","+i[2]+")"}]}}function onMove(e){if(e){var t=svg.element.select("#"+e.getAttribute("id")+"c"),i=e.getBoundingClientRect(),n=dots.getBoundingClientRect();t.attr("cx",i.left-n.left+dotSize).attr("cy",i.top-n.top+dotSize),render()}}function bestCandidateSampler(e,t,i,n){return function(){if(!(++numSamples>n)){for(var r,o=0,s=0;i>s;++s){var a=[Math.random()*e,Math.random()*t],l=distance(quadtree.find(a),a);l>o&&(o=l,r=a)}return quadtree.add(r),r}}}function readImage(){if(this.files&&this.files[0]){var e=new FileReader;e.onload=function(e){img.preview.setAttribute("src",e.target.result)},e.readAsDataURL(this.files[0])}}function initGif(){var e=document.createElement("img");e.style.visibility="hidden";var t=[];t.push("dancingmonkey.gif"),t.push("dancingmonkey2.gif"),t.push("patterns.gif"),t.push("cheetah.gif");var i=[];i.push("fun"),i.push("happy"),i.push("dark"),i.push("unhappy"),i.push("sad"),i.push("angry"),i.push("worried"),i.push("paranoid"),i.push("compassion"),i.push("excited"),i.push("elated"),i.push("crazy"),i.push("love"),i.push("hate");var n=Math.floor(Math.random()*i.length);mood=i[n],console.log("mood: ",mood);var r=mood,o=new XMLHttpRequest;o.open("GET","http://api.giphy.com/v1/gifs/random?api_key=dc6zaTOxFJmzC&tag="+r,!0),o.onload=function(){console.log("Retrieving gif from giphy."),o.status>=200&&400>o.status?(data=JSON.parse(o.responseText).data.image_url,null!=e&&(e.src=data,playGIF(e,img.preview))):console.log("reached giphy, but API returned an error")},o.onerror=function(){console.log("connection error")},o.send();var n=Math.floor(Math.random()*t.length);console.log(n)}var Delaunay;(function(){"use strict";function e(e){var t,i,n,r,o,s,a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(t=e.length;t--;)a>e[t][0]&&(a=e[t][0]),e[t][0]>d&&(d=e[t][0]),l>e[t][1]&&(l=e[t][1]),e[t][1]>c&&(c=e[t][1]);return i=d-a,n=c-l,r=Math.max(i,n),o=a+.5*i,s=l+.5*n,[[o-20*r,s-r],[o,s+20*r],[o+20*r,s-r]]}function t(e,t,i,r){var o,s,a,l,d,c,u,h,f,p,m=e[t][0],g=e[t][1],_=e[i][0],b=e[i][1],v=e[r][0],y=e[r][1],S=Math.abs(g-b),x=Math.abs(b-y);if(n>S&&n>x)throw Error("Eek! Coincident points!");return n>S?(l=-((v-_)/(y-b)),c=(_+v)/2,h=(b+y)/2,o=(_+m)/2,s=l*(o-c)+h):n>x?(a=-((_-m)/(b-g)),d=(m+_)/2,u=(g+b)/2,o=(v+_)/2,s=a*(o-d)+u):(a=-((_-m)/(b-g)),l=-((v-_)/(y-b)),d=(m+_)/2,c=(_+v)/2,u=(g+b)/2,h=(b+y)/2,o=(a*d-l*c+h-u)/(a-l),s=S>x?a*(o-d)+u:l*(o-c)+h),f=_-o,p=b-s,{i:t,j:i,k:r,x:o,y:s,r:f*f+p*p}}function i(e){var t,i,n,r,o,s;for(i=e.length;i;)for(r=e[--i],n=e[--i],t=i;t;)if(s=e[--t],o=e[--t],n===o&&r===s||n===s&&r===o){e.splice(i,2),e.splice(t,2);break}}var n=1/1048576;Delaunay={triangulate:function(r,o){var s,a,l,d,c,u,h,f,p,m,g,_,b=r.length;if(3>b)return[];if(r=r.slice(0),o)for(s=b;s--;)r[s]=r[s][o];for(l=Array(b),s=b;s--;)l[s]=s;for(l.sort(function(e,t){return r[t][0]-r[e][0]}),d=e(r),r.push(d[0],d[1],d[2]),c=[t(r,b+0,b+1,b+2)],u=[],h=[],s=l.length;s--;h.length=0){for(_=l[s],a=c.length;a--;)f=r[_][0]-c[a].x,f>0&&f*f>c[a].r?(u.push(c[a]),c.splice(a,1)):(p=r[_][1]-c[a].y,f*f+p*p-c[a].r>n||(h.push(c[a].i,c[a].j,c[a].j,c[a].k,c[a].k,c[a].i),c.splice(a,1)));for(i(h),a=h.length;a;)g=h[--a],m=h[--a],c.push(t(r,m,g,_))}for(s=c.length;s--;)u.push(c[s]);for(c.length=0,s=u.length;s--;)b>u[s].i&&b>u[s].j&&b>u[s].k&&c.push(u[s].i,u[s].j,u[s].k);return c},contains:function(e,t){if(t[0]<e[0][0]&&t[0]<e[1][0]&&t[0]<e[2][0]||t[0]>e[0][0]&&t[0]>e[1][0]&&t[0]>e[2][0]||t[1]<e[0][1]&&t[1]<e[1][1]&&t[1]<e[2][1]||t[1]>e[0][1]&&t[1]>e[1][1]&&t[1]>e[2][1])return null;var i=e[1][0]-e[0][0],n=e[2][0]-e[0][0],r=e[1][1]-e[0][1],o=e[2][1]-e[0][1],s=i*o-n*r;if(0===s)return null;var a=(o*(t[0]-e[0][0])-n*(t[1]-e[0][1]))/s,l=(i*(t[1]-e[0][1])-r*(t[0]-e[0][0]))/s;return 0>a||0>l||a+l>1?null:[a,l]}},"undefined"!=typeof module&&(module.exports=Delaunay)})(),function(e,t,i){function n(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}function r(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return g[e.which]?g[e.which]:_[e.which]?_[e.which]:String.fromCharCode(e.which).toLowerCase()}function o(e){e=e||{};var t,i=!1;for(t in x)e[t]?i=!0:x[t]=0;i||(E=!1)}function s(e,t,i,n,r,o){var s,a,l=[],d=i.type;if(!y[e])return[];for("keyup"==d&&c(e)&&(t=[e]),s=0;y[e].length>s;++s)if(a=y[e][s],!(!n&&a.seq&&x[a.seq]!=a.level||d!=a.action||("keypress"!=d||i.metaKey||i.ctrlKey)&&t.sort().join(",")!==a.modifiers.sort().join(","))){var u=n&&a.seq==n&&a.level==o;(!n&&a.combo==r||u)&&y[e].splice(s,1),l.push(a)}return l}function a(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function l(e,t,i,n){F.stopCallback(t,t.target||t.srcElement,i,n)||!1!==e(t,i)||(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)}function d(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=r(e);t&&("keyup"==e.type&&w===t?w=!1:F.handleKey(t,a(e),e))}function c(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function u(e,t,i,n){function s(t){return function(){E=t,++x[e],clearTimeout(m),m=setTimeout(o,1e3)}}function a(t){l(i,t,e),"keyup"!==n&&(w=r(t)),setTimeout(o,10)}for(var d=x[e]=0;t.length>d;++d){var c=d+1===t.length?a:s(n||h(t[d+1]).action);f(t[d],c,n,e,d)}}function h(e,t){var i,n,r,o=[];for(i="+"===e?["+"]:e.split("+"),r=0;i.length>r;++r)n=i[r],v[n]&&(n=v[n]),t&&"keypress"!=t&&b[n]&&(n=b[n],o.push("shift")),c(n)&&o.push(n);if(i=n,r=t,!r){if(!p){p={};for(var s in g)s>95&&112>s||g.hasOwnProperty(s)&&(p[g[s]]=s)}r=p[i]?"keydown":"keypress"}return"keypress"==r&&o.length&&(r="keydown"),{key:n,modifiers:o,action:r}}function f(e,t,i,n,r){S[e+":"+i]=t,e=e.replace(/\s+/g," ");var o=e.split(" ");o.length>1?u(e,o,t,i):(i=h(e,i),y[i.key]=y[i.key]||[],s(i.key,i.modifiers,{type:i.action},n,e,r),y[i.key][n?"unshift":"push"]({callback:t,modifiers:i.modifiers,action:i.action,seq:n,level:r,combo:e}))}var p,m,g={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},b={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},v={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},y={},S={},x={},w=!1,C=!1,E=!1;for(i=1;20>i;++i)g[111+i]="f"+i;for(i=0;9>=i;++i)g[i+96]=i;n(t,"keypress",d),n(t,"keydown",d),n(t,"keyup",d);var F={bind:function(e,t,i){e=e instanceof Array?e:[e];for(var n=0;e.length>n;++n)f(e[n],t,i);return this},unbind:function(e,t){return F.bind(e,function(){},t)},trigger:function(e,t){return S[e+":"+t]&&S[e+":"+t]({},e),this},reset:function(){return y={},S={},this},stopCallback:function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},handleKey:function(e,t,i){var n,r=s(e,t,i);t={};var a=0,d=!1;for(n=0;r.length>n;++n)r[n].seq&&(a=Math.max(a,r[n].level));for(n=0;r.length>n;++n)r[n].seq?r[n].level==a&&(d=!0,t[r[n].seq]=1,l(r[n].callback,i,r[n].combo,r[n].seq)):d||l(r[n].callback,i,r[n].combo);r="keypress"==i.type&&C,i.type!=E||c(e)||r||o(t),C=d&&"keydown"==i.type}};e.Mousetrap=F,"function"==typeof define&&define.amd&&define(F)}(window,document),function(){function e(e,t){return[].slice.call((t||document).querySelectorAll(e))}if(window.addEventListener){var t=window.StyleFix={link:function(e){try{if("stylesheet"!==e.rel||e.hasAttribute("data-noprefix"))return}catch(i){return}var n,r=e.href||e.getAttribute("data-href"),o=r.replace(/[^\/]+$/,""),s=(/^[a-z]{3,10}:/.exec(o)||[""])[0],a=(/^[a-z]{3,10}:\/\/[^\/]+/.exec(o)||[""])[0],l=/^([^?]*)\??/.exec(r)[1],d=e.parentNode,c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&n()},n=function(){var i=c.responseText;if(i&&e.parentNode&&(!c.status||400>c.status||c.status>600)){if(i=t.fix(i,!0,e),o){i=i.replace(/url\(\s*?((?:"|')?)(.+?)\1\s*?\)/gi,function(e,t,i){return/^([a-z]{3,10}:|#)/i.test(i)?e:/^\/\//.test(i)?'url("'+s+i+'")':/^\//.test(i)?'url("'+a+i+'")':/^\?/.test(i)?'url("'+l+i+'")':'url("'+o+i+'")'});var n=o.replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1");i=i.replace(RegExp("\\b(behavior:\\s*?url\\('?\"?)"+n,"gi"),"$1")}var r=document.createElement("style");r.textContent=i,r.media=e.media,r.disabled=e.disabled,r.setAttribute("data-href",e.getAttribute("href")),d.insertBefore(r,e),d.removeChild(e),r.media=e.media}};try{c.open("GET",r),c.send(null)}catch(i){"undefined"!=typeof XDomainRequest&&(c=new XDomainRequest,c.onerror=c.onprogress=function(){},c.onload=n,c.open("GET",r),c.send(null))}e.setAttribute("data-inprogress","")},styleElement:function(e){if(!e.hasAttribute("data-noprefix")){var i=e.disabled;e.textContent=t.fix(e.textContent,!0,e),e.disabled=i}},styleAttribute:function(e){var i=e.getAttribute("style");i=t.fix(i,!1,e),e.setAttribute("style",i)},process:function(){e('link[rel="stylesheet"]:not([data-inprogress])').forEach(StyleFix.link),e("style").forEach(StyleFix.styleElement),e("[style]").forEach(StyleFix.styleAttribute)},register:function(e,i){(t.fixers=t.fixers||[]).splice(void 0===i?t.fixers.length:i,0,e)},fix:function(e,i,n){for(var r=0;t.fixers.length>r;r++)e=t.fixers[r](e,i,n)||e;return e},camelCase:function(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()}).replace("-","")},deCamelCase:function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})}};(function(){setTimeout(function(){e('link[rel="stylesheet"]').forEach(StyleFix.link)},10),document.addEventListener("DOMContentLoaded",StyleFix.process,!1)})()}}(),function(e){function t(e,t,n,r,o){if(e=i[e],e.length){var s=RegExp(t+"("+e.join("|")+")"+n,"gi");o=o.replace(s,r)}return o}if(window.StyleFix&&window.getComputedStyle){var i=window.PrefixFree={prefixCSS:function(e,n){var r=i.prefix;if(i.functions.indexOf("linear-gradient")>-1&&(e=e.replace(/(\s|:|,)(repeating-)?linear-gradient\(\s*(-?\d*\.?\d*)deg/gi,function(e,t,i,n){return t+(i||"")+"linear-gradient("+(90-n)+"deg"})),e=t("functions","(\\s|:|,)","\\s*\\(","$1"+r+"$2(",e),e=t("keywords","(\\s|:)","(\\s|;|\\}|$)","$1"+r+"$2$3",e),e=t("properties","(^|\\{|\\s|;)","\\s*:","$1"+r+"$2:",e),i.properties.length){var o=RegExp("\\b("+i.properties.join("|")+")(?!:)","gi");e=t("valueProperties","\\b",":(.+?);",function(e){return e.replace(o,r+"$1")},e)}return n&&(e=t("selectors","","\\b",i.prefixSelector,e),e=t("atrules","@","\\b","@"+r+"$1",e)),e=e.replace(RegExp("-"+r,"g"),"-"),e=e.replace(/-\*-(?=[a-z]+)/gi,i.prefix)},property:function(e){return(i.properties.indexOf(e)?i.prefix:"")+e},value:function(e){return e=t("functions","(^|\\s|,)","\\s*\\(","$1"+i.prefix+"$2(",e),e=t("keywords","(^|\\s)","(\\s|$)","$1"+i.prefix+"$2$3",e)},prefixSelector:function(e){return e.replace(/^:{1,2}/,function(e){return e+i.prefix})},prefixProperty:function(e,t){var n=i.prefix+e;return t?StyleFix.camelCase(n):n}};(function(){var e={},t=[],n=getComputedStyle(document.documentElement,null),r=document.createElement("div").style,o=function(i){if("-"===i.charAt(0)){t.push(i);var n=i.split("-"),r=n[1];for(e[r]=++e[r]||1;n.length>3;){n.pop();var o=n.join("-");s(o)&&-1===t.indexOf(o)&&t.push(o)}}},s=function(e){return StyleFix.camelCase(e)in r};if(n.length>0)for(var a=0;n.length>a;a++)o(n[a]);else for(var l in n)o(StyleFix.deCamelCase(l));var d={uses:0};for(var c in e){var u=e[c];u>d.uses&&(d={prefix:c,uses:u})}i.prefix="-"+d.prefix+"-",i.Prefix=StyleFix.camelCase(i.prefix),i.properties=[];for(var a=0;t.length>a;a++){var l=t[a];if(0===l.indexOf(i.prefix)){var h=l.slice(i.prefix.length);s(h)||i.properties.push(h)}}"Ms"==i.Prefix&&!("transform"in r)&&!("MsTransform"in r)&&"msTransform"in r&&i.properties.push("transform","transform-origin"),i.properties.sort()})(),function(){function e(e,t){return r[t]="",r[t]=e,!!r[t]}var t={"linear-gradient":{property:"backgroundImage",params:"red, teal"},calc:{property:"width",params:"1px + 5%"},element:{property:"backgroundImage",params:"#foo"},"cross-fade":{property:"backgroundImage",params:"url(a.png), url(b.png), 50%"}};t["repeating-linear-gradient"]=t["repeating-radial-gradient"]=t["radial-gradient"]=t["linear-gradient"];var n={initial:"color","zoom-in":"cursor","zoom-out":"cursor",box:"display",flexbox:"display","inline-flexbox":"display",flex:"display","inline-flex":"display",grid:"display","inline-grid":"display","min-content":"width"};i.functions=[],i.keywords=[];var r=document.createElement("div").style;for(var o in t){var s=t[o],a=s.property,l=o+"("+s.params+")";!e(l,a)&&e(i.prefix+l,a)&&i.functions.push(o)}for(var d in n){var a=n[d];!e(d,a)&&e(i.prefix+d,a)&&i.keywords.push(d)}}(),function(){function t(e){return o.textContent=e+"{}",!!o.sheet.cssRules.length}var n={":read-only":null,":read-write":null,":any-link":null,"::selection":null},r={keyframes:"name",viewport:null,document:'regexp(".")'};i.selectors=[],i.atrules=[];var o=e.appendChild(document.createElement("style"));for(var s in n){var a=s+(n[s]?"("+n[s]+")":"");!t(a)&&t(i.prefixSelector(a))&&i.selectors.push(s)}for(var l in r){var a=l+" "+(r[l]||"");!t("@"+a)&&t("@"+i.prefix+a)&&i.atrules.push(l)}e.removeChild(o)}(),i.valueProperties=["transition","transition-property"],e.className+=" "+i.prefix,StyleFix.register(i.prefixCSS)}}(document.documentElement),FSS={FRONT:0,BACK:1,DOUBLE:2,SVGNS:"http://www.w3.org/2000/svg"},FSS.Array="function"==typeof Float32Array?Float32Array:Array,FSS.Utils={isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;t.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var i=(new Date).getTime(),n=Math.max(0,16-(i-e)),r=window.setTimeout(function(){t(i+n)},n);return e=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Math.PIM2=2*Math.PI,Math.PID2=Math.PI/2,Math.randomInRange=function(e,t){return e+(t-e)*Math.random()},Math.clamp=function(e,t,i){return e=Math.max(e,t),e=Math.min(e,i)},FSS.Vector3={create:function(e,t,i){var n=new FSS.Array(3);return this.set(n,e,t,i),n},clone:function(e){var t=this.create();return this.copy(t,e),t},set:function(e,t,i,n){return e[0]=t||0,e[1]=i||0,e[2]=n||0,this},setX:function(e,t){return e[0]=t||0,this},setY:function(e,t){return e[1]=t||0,this},setZ:function(e,t){return e[2]=t||0,this},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],this},add:function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],this},addVectors:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],this},addScalar:function(e,t){return e[0]+=t,e[1]+=t,e[2]+=t,this},subtract:function(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],this},subtractVectors:function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],this},subtractScalar:function(e,t){return e[0]-=t,e[1]-=t,e[2]-=t,this},multiply:function(e,t){return e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],this},multiplyVectors:function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],this},multiplyScalar:function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,this},divide:function(e,t){return e[0]/=t[0],e[1]/=t[1],e[2]/=t[2],this},divideVectors:function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],this},divideScalar:function(e,t){return 0!==t?(e[0]/=t,e[1]/=t,e[2]/=t):(e[0]=0,e[1]=0,e[2]=0),this},cross:function(e,t){var i=e[0],n=e[1],r=e[2];return e[0]=n*t[2]-r*t[1],e[1]=r*t[0]-i*t[2],e[2]=i*t[1]-n*t[0],this},crossVectors:function(e,t,i){return e[0]=t[1]*i[2]-t[2]*i[1],e[1]=t[2]*i[0]-t[0]*i[2],e[2]=t[0]*i[1]-t[1]*i[0],this},min:function(e,t){return t>e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),t>e[2]&&(e[2]=t),this},max:function(e,t){return e[0]>t&&(e[0]=t),e[1]>t&&(e[1]=t),e[2]>t&&(e[2]=t),this},clamp:function(e,t,i){return this.min(e,t),this.max(e,i),this},limit:function(e,t,i){var n=this.length(e);return null!==t&&t>n?this.setLength(e,t):null!==i&&n>i&&this.setLength(e,i),this},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},normalise:function(e){return this.divideScalar(e,this.length(e))},negate:function(e){return this.multiplyScalar(e,-1)},distanceSquared:function(e,t){var i=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return i*i+n*n+r*r},distance:function(e,t){return Math.sqrt(this.distanceSquared(e,t))},lengthSquared:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},length:function(e){return Math.sqrt(this.lengthSquared(e))},setLength:function(e,t){var i=this.length(e);return 0!==i&&t!==i&&this.multiplyScalar(e,t/i),this}},FSS.Vector4={create:function(e,t,i){var n=new FSS.Array(4);return this.set(n,e,t,i),n},set:function(e,t,i,n,r){return e[0]=t||0,e[1]=i||0,e[2]=n||0,e[3]=r||0,this},setX:function(e,t){return e[0]=t||0,this},setY:function(e,t){return e[1]=t||0,this},setZ:function(e,t){return e[2]=t||0,this},setW:function(e,t){return e[3]=t||0,this},add:function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],this},multiplyVectors:function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],this},multiplyScalar:function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},min:function(e,t){return t>e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),t>e[2]&&(e[2]=t),t>e[3]&&(e[3]=t),this},max:function(e,t){return e[0]>t&&(e[0]=t),e[1]>t&&(e[1]=t),e[2]>t&&(e[2]=t),e[3]>t&&(e[3]=t),this},clamp:function(e,t,i){return this.min(e,t),this.max(e,i),this}},FSS.Color=function(e,t){this.rgba=FSS.Vector4.create(),this.hex=e||"#000000",this.opacity=FSS.Utils.isNumber(t)?t:1,this.set(this.hex,this.opacity)},FSS.Color.prototype={set:function(e,t){e=e.replace("#","");var i=e.length/3;return this.rgba[0]=parseInt(e.substring(0*i,1*i),16)/255,this.rgba[1]=parseInt(e.substring(1*i,2*i),16)/255,this.rgba[2]=parseInt(e.substring(2*i,3*i),16)/255,this.rgba[3]=FSS.Utils.isNumber(t)?t:this.rgba[3],this},hexify:function(e){var t=Math.ceil(255*e).toString(16);return 1===t.length&&(t="0"+t),t},format:function(){var e=this.hexify(this.rgba[0]),t=this.hexify(this.rgba[1]),i=this.hexify(this.rgba[2]);return this.hex="#"+e+t+i,this.hex}},FSS.Object=function(){this.position=FSS.Vector3.create()},FSS.Object.prototype={setPosition:function(e,t,i){return FSS.Vector3.set(this.position,e,t,i),this}},FSS.Light=function(e,t){FSS.Object.call(this),this.ambient=new FSS.Color(e||"#FFFFFF"),this.diffuse=new FSS.Color(t||"#FFFFFF"),this.ray=FSS.Vector3.create()},FSS.Light.prototype=Object.create(FSS.Object.prototype),FSS.Vertex=function(e,t,i){this.position=FSS.Vector3.create(e,t,i)},FSS.Vertex.prototype={setPosition:function(e,t,i){return FSS.Vector3.set(this.position,e,t,i),this}},FSS.Triangle=function(e,t,i){this.a=e||new FSS.Vertex,this.b=t||new FSS.Vertex,this.c=i||new FSS.Vertex,this.vertices=[this.a,this.b,this.c],this.u=FSS.Vector3.create(),this.v=FSS.Vector3.create(),this.centroid=FSS.Vector3.create(),this.normal=FSS.Vector3.create(),this.color=new FSS.Color,this.polygon=document.createElementNS(FSS.SVGNS,"polygon"),this.polygon.setAttributeNS(null,"stroke-linejoin","round"),this.polygon.setAttributeNS(null,"stroke-miterlimit","1"),this.polygon.setAttributeNS(null,"stroke-width","1"),this.computeCentroid(),this.computeNormal()},FSS.Triangle.prototype={computeCentroid:function(){return this.centroid[0]=this.a.position[0]+this.b.position[0]+this.c.position[0],this.centroid[1]=this.a.position[1]+this.b.position[1]+this.c.position[1],this.centroid[2]=this.a.position[2]+this.b.position[2]+this.c.position[2],FSS.Vector3.divideScalar(this.centroid,3),this},computeNormal:function(){return FSS.Vector3.subtractVectors(this.u,this.b.position,this.a.position),FSS.Vector3.subtractVectors(this.v,this.c.position,this.a.position),FSS.Vector3.crossVectors(this.normal,this.u,this.v),FSS.Vector3.normalise(this.normal),this}},FSS.Geometry=function(){this.vertices=[],this.triangles=[],this.dirty=!1},FSS.Geometry.prototype={update:function(){if(this.dirty){var e,t;for(e=this.triangles.length-1;e>=0;e--)t=this.triangles[e],t.computeCentroid(),t.computeNormal();this.dirty=!1}return this}};var imported=document.createElement("script");imported.src="js/jsfeat-min.js",document.head.appendChild(imported),FSS.Plane=function(e,t,i,n){FSS.Geometry.call(this),this.width=e||100,this.height=t||100;var r,o,s=Array(i);for(offsetX=this.width*-.5,offsetY=.5*this.height,c=s.length;c--;)r=offsetX+Math.random()*e,o=offsetY-Math.random()*t,s[c]=[r,o];if(n){var a=1,l=30;jsfeat.fast_corners.set_threshold(l);for(var d=[],c=0;n.grayscale.cols*n.grayscale.rows>c;++c)d[c]=new jsfeat.keypoint_t(0,0,0,0);for(var u=Math.min(500,jsfeat.fast_corners.detect(n.grayscale,d,3)),c=0;u>c;c++)createPoint([d[c].x*a,d[c].y*a],c);u>0&&console.log("Feature points added.")}else console.log("No image loaded, not adding feature points.");s.push([offsetX,offsetY]),s.push([offsetX+e/2,offsetY]),s.push([offsetX+e,offsetY]),s.push([offsetX+e,offsetY-t/2]),s.push([offsetX+e,offsetY-t]),s.push([offsetX+e/2,offsetY-t]),s.push([offsetX,offsetY-t]),s.push([offsetX,offsetY-t/2]);for(var c=6;c>=0;c--)s.push([offsetX+Math.random()*e,offsetY]),s.push([offsetX,offsetY-Math.random()*t]),s.push([offsetX+e,offsetY-Math.random()*t]),s.push([offsetX+Math.random()*e,offsetY-t]);var h=Delaunay.triangulate(s);for(c=h.length;c;)--c,v1=new FSS.Vertex(Math.ceil(s[h[c]][0]),Math.ceil(s[h[c]][1])),--c,v2=new FSS.Vertex(Math.ceil(s[h[c]][0]),Math.ceil(s[h[c]][1])),--c,v3=new FSS.Vertex(Math.ceil(s[h[c]][0]),Math.ceil(s[h[c]][1])),t1=new FSS.Triangle(v1,v2,v3),this.triangles.push(t1),this.vertices.push(v1),this.vertices.push(v2),this.vertices.push(v3)},FSS.Plane.prototype=Object.create(FSS.Geometry.prototype),FSS.Material=function(e,t){this.ambient=new FSS.Color(e||"#444444"),this.diffuse=new FSS.Color(t||"#FFFFFF"),this.slave=new FSS.Color},FSS.Mesh=function(e,t){FSS.Object.call(this),this.geometry=e||new FSS.Geometry,this.material=t||new FSS.Material,this.side=FSS.FRONT,this.visible=!0},FSS.Mesh.prototype=Object.create(FSS.Object.prototype),FSS.Mesh.prototype.update=function(e,t,i){var n,r,o,s,a;if(this.geometry.update(),i)for(n=this.geometry.triangles.length-1;n>=0;n--){for(r=this.geometry.triangles[n],r.color=getTriangleColor(r.centroid,this.getBBox(),e),o=t.length-1;o>=0;o--)s=t[o],FSS.Vector3.subtractVectors(s.ray,s.position,r.centroid),FSS.Vector3.normalise(s.ray),a=FSS.Vector3.dot(r.normal,s.ray),this.side===FSS.FRONT?a=Math.max(a,0):this.side===FSS.BACK?a=Math.abs(Math.min(a,0)):this.side===FSS.DOUBLE&&(a=Math.max(Math.abs(a),0)),FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.ambient.rgba,s.ambient.rgba),FSS.Vector4.add(r.color.rgba,this.material.slave.rgba),FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.diffuse.rgba,s.diffuse.rgba),FSS.Vector4.multiplyScalar(this.material.slave.rgba,a),FSS.Vector4.add(r.color.rgba,this.material.slave.rgba);FSS.Vector4.clamp(r.color.rgba,0,1)}return this},FSS.Mesh.prototype.getBBox=function(){var e,t,n,r,o,s;for(e=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=this.geometry.triangles.length-1;o>=0;o--){s=this.geometry.triangles[o];var a=s.vertices;for(i=0;2>i;i++){var l=a[i];e>l.position[0]&&(e=l.position[0]),l.position[0]>t&&(t=l.position[0]),n>l.position[1]&&(n=l.position[1]),l.position[1]>r&&(r=l.position[1])}}return[e,t,n,r]},FSS.Scene=function(){this.meshes=[],this.lights=[]},FSS.Scene.prototype={add:function(e){return e instanceof FSS.Mesh&&!~this.meshes.indexOf(e)?this.meshes.push(e):e instanceof FSS.Light&&!~this.lights.indexOf(e)&&this.lights.push(e),this},remove:function(e){return e instanceof FSS.Mesh&&~this.meshes.indexOf(e)?this.meshes.splice(this.meshes.indexOf(e),1):e instanceof FSS.Light&&~this.lights.indexOf(e)&&this.lights.splice(this.lights.indexOf(e),1),this}},FSS.Renderer=function(){this.width=0,this.height=0,this.halfWidth=0,this.halfHeight=0},FSS.Renderer.prototype={setSize:function(e,t){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this):void 0},clear:function(){return this},render:function(){return this}},FSS.CanvasRenderer=function(){FSS.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.context=this.element.getContext("2d"),this.setSize(this.element.width,this.element.height)},FSS.CanvasRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.CanvasRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.element.width=e,this.element.height=t,this.context.setTransform(1,0,0,-1,this.halfWidth,this.halfHeight),this},FSS.CanvasRenderer.prototype.clear=function(){return FSS.Renderer.prototype.clear.call(this),this.context.clearRect(-this.halfWidth,-this.halfHeight,this.width,this.height),this},FSS.CanvasRenderer.prototype.render=function(e){FSS.Renderer.prototype.render.call(this,e);var t,i,n,r,o;for(this.clear(),this.context.lineJoin="round",this.context.lineWidth=1,t=e.meshes.length-1;t>=0;t--)if(i=e.meshes[t],i.visible)for(i.update(this,e.lights,!0),n=i.geometry.triangles.length-1;n>=0;n--)r=i.geometry.triangles[n],o=r.color.format(),this.context.beginPath(),this.context.moveTo(r.a.position[0],r.a.position[1]),this.context.lineTo(r.b.position[0],r.b.position[1]),this.context.lineTo(r.c.position[0],r.c.position[1]),this.context.closePath(),this.context.strokeStyle=o,this.context.fillStyle=o,this.context.stroke(),this.context.fill();return this},FSS.WebGLRenderer=function(){FSS.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.vertices=null,this.lights=null;var e={preserveDrawingBuffer:!1,premultipliedAlpha:!0,antialias:!0,stencil:!0,alpha:!0};return this.gl=this.getContext(this.element,e),this.unsupported=!this.gl,this.unsupported?"WebGL is not supported by your browser.":(this.gl.clearColor(0,0,0,0),this.gl.enable(this.gl.DEPTH_TEST),this.setSize(this.element.width,this.element.height),void 0)},FSS.WebGLRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.WebGLRenderer.prototype.getContext=function(e,t){var i=!1;try{if(!(i=e.getContext("experimental-webgl",t)))throw"Error creating WebGL context."}catch(n){console.error(n)}return i},FSS.WebGLRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.unsupported?void 0:(this.element.width=e,this.element.height=t,this.gl.viewport(0,0,e,t),this)},FSS.WebGLRenderer.prototype.clear=function(){return FSS.Renderer.prototype.clear.call(this),this.unsupported?void 0:(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this)},FSS.WebGLRenderer.prototype.render=function(e){if(FSS.Renderer.prototype.render.call(this,e),!this.unsupported){var t,i,n,r,o,s,a,l,d,c,u,h,f,p,m,g=!1,_=e.lights.length,b=0;if(this.clear(),this.lights!==_){if(this.lights=_,!(this.lights>0))return;this.buildProgram(_)}if(this.program){for(t=e.meshes.length-1;t>=0;t--)i=e.meshes[t],i.geometry.dirty&&(g=!0),i.update(this,e.lights,!1),b+=3*i.geometry.triangles.length;if(g||this.vertices!==b){this.vertices=b;for(l in this.program.attributes){for(c=this.program.attributes[l],c.data=new FSS.Array(b*c.size),f=0,t=e.meshes.length-1;t>=0;t--)for(i=e.meshes[t],n=0,r=i.geometry.triangles.length;r>n;n++)for(o=i.geometry.triangles[n],p=0,m=o.vertices.length;m>p;p++){switch(vertex=o.vertices[p],l){case"side":this.setBufferData(f,c,i.side);break;case"position":this.setBufferData(f,c,vertex.position);break;case"centroid":this.setBufferData(f,c,o.centroid);break;case"normal":this.setBufferData(f,c,o.normal);break;case"ambient":this.setBufferData(f,c,o.color.rgba);break;case"diffuse":this.setBufferData(f,c,o.color.rgba)}f++}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,c.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,c.data,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(c.location),this.gl.vertexAttribPointer(c.location,c.size,this.gl.FLOAT,!1,0,0)}}for(this.setBufferData(0,this.program.uniforms.resolution,[this.width,this.height,this.width]),s=_-1;s>=0;s--)a=e.lights[s],this.setBufferData(s,this.program.uniforms.lightPosition,a.position),this.setBufferData(s,this.program.uniforms.lightAmbient,a.ambient.rgba),this.setBufferData(s,this.program.uniforms.lightDiffuse,a.diffuse.rgba);for(d in this.program.uniforms)switch(c=this.program.uniforms[d],h=c.location,u=c.data,c.structure){case"3f":this.gl.uniform3f(h,u[0],u[1],u[2]);break;case"3fv":this.gl.uniform3fv(h,u);break;case"4fv":this.gl.uniform4fv(h,u)}}return this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices),this}},FSS.WebGLRenderer.prototype.setBufferData=function(e,t,i){if(FSS.Utils.isNumber(i))t.data[e*t.size]=i;else for(var n=i.length-1;n>=0;n--)t.data[e*t.size+n]=i[n]},FSS.WebGLRenderer.prototype.buildProgram=function(e){if(!this.unsupported){var t=FSS.WebGLRenderer.VS(e),i=FSS.WebGLRenderer.FS(e),n=t+i;if(!this.program||this.program.code!==n){var r=this.gl.createProgram(),o=this.buildShader(this.gl.VERTEX_SHADER,t),s=this.buildShader(this.gl.FRAGMENT_SHADER,i);if(this.gl.attachShader(r,o),this.gl.attachShader(r,s),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS)){var a=this.gl.getError(),l=this.gl.getProgramParameter(r,this.gl.VALIDATE_STATUS);return console.error("Could not initialise shader.\nVALIDATE_STATUS: "+l+"\nERROR: "+a),null}return this.gl.deleteShader(s),this.gl.deleteShader(o),r.code=n,r.attributes={side:this.buildBuffer(r,"attribute","aSide",1,"f"),position:this.buildBuffer(r,"attribute","aPosition",3,"v3"),centroid:this.buildBuffer(r,"attribute","aCentroid",3,"v3"),normal:this.buildBuffer(r,"attribute","aNormal",3,"v3"),ambient:this.buildBuffer(r,"attribute","aAmbient",4,"v4"),diffuse:this.buildBuffer(r,"attribute","aDiffuse",4,"v4")},r.uniforms={resolution:this.buildBuffer(r,"uniform","uResolution",3,"3f",1),lightPosition:this.buildBuffer(r,"uniform","uLightPosition",3,"3fv",e),lightAmbient:this.buildBuffer(r,"uniform","uLightAmbient",4,"4fv",e),lightDiffuse:this.buildBuffer(r,"uniform","uLightDiffuse",4,"4fv",e)},this.program=r,this.gl.useProgram(this.program),r}}},FSS.WebGLRenderer.prototype.buildShader=function(e,t){if(!this.unsupported){var i=this.gl.createShader(e);return this.gl.shaderSource(i,t),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(console.error(this.gl.getShaderInfoLog(i)),null)
}},FSS.WebGLRenderer.prototype.buildBuffer=function(e,t,i,n,r,o){var s={buffer:this.gl.createBuffer(),size:n,structure:r,data:null};switch(t){case"attribute":s.location=this.gl.getAttribLocation(e,i);break;case"uniform":s.location=this.gl.getUniformLocation(e,i)}return o&&(s.data=new FSS.Array(o*n)),s},FSS.WebGLRenderer.VS=function(e){var t=["precision mediump float;","#define LIGHTS "+e,"attribute float aSide;","attribute vec3 aPosition;","attribute vec3 aCentroid;","attribute vec3 aNormal;","attribute vec4 aAmbient;","attribute vec4 aDiffuse;","uniform vec3 uResolution;","uniform vec3 uLightPosition[LIGHTS];","uniform vec4 uLightAmbient[LIGHTS];","uniform vec4 uLightDiffuse[LIGHTS];","varying vec4 vColor;","void main() {","vColor = vec4(0.0);","vec3 position = aPosition / uResolution * 2.0;","for (int i = 0; i < LIGHTS; i++) {","vec3 lightPosition = uLightPosition[i];","vec4 lightAmbient = uLightAmbient[i];","vec4 lightDiffuse = uLightDiffuse[i];","vec3 ray = normalize(lightPosition - aCentroid);","float illuminance = dot(aNormal, ray);","if (aSide == 0.0) {","illuminance = max(illuminance, 0.0);","} else if (aSide == 1.0) {","illuminance = abs(min(illuminance, 0.0));","} else if (aSide == 2.0) {","illuminance = max(abs(illuminance), 0.0);","}","vColor += aAmbient * lightAmbient;","vColor += aDiffuse * lightDiffuse * illuminance;","}","vColor = clamp(vColor, 0.0, 1.0);","gl_Position = vec4(position, 1.0);","}"].join("\n");return t},FSS.WebGLRenderer.FS=function(){var e=["precision mediump float;","varying vec4 vColor;","void main() {","gl_FragColor = vColor;","}"].join("\n");return e},FSS.SVGRenderer=function(){FSS.Renderer.call(this),this.element=document.createElementNS(FSS.SVGNS,"svg"),this.element.setAttribute("xmlns",FSS.SVGNS),this.element.setAttribute("version","1.1"),this.element.style.display="block",this.setSize(300,150)},FSS.SVGRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.SVGRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.element.setAttribute("width",e),this.element.setAttribute("height",t),this},FSS.SVGRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);for(var e=this.element.childNodes.length-1;e>=0;e--)this.element.removeChild(this.element.childNodes[e]);return this},FSS.SVGRenderer.prototype.render=function(e){FSS.Renderer.prototype.render.call(this,e);var t,i,n,r,o,s;for(t=e.meshes.length-1;t>=0;t--)if(i=e.meshes[t],i.visible)for(i.update(e.lights,!0),n=i.geometry.triangles.length-1;n>=0;n--)r=i.geometry.triangles[n],r.polygon.parentNode!==this.element&&this.element.appendChild(r.polygon),o=this.formatPoint(r.a)+" ",o+=this.formatPoint(r.b)+" ",o+=this.formatPoint(r.c),s=this.formatStyle(r.color.format()),r.polygon.setAttributeNS(null,"points",o),r.polygon.setAttributeNS(null,"style",s);return this},FSS.SVGRenderer.prototype.formatPoint=function(e){return this.halfWidth+e.position[0]+","+(this.halfHeight-e.position[1])},FSS.SVGRenderer.prototype.formatStyle=function(e){var t="fill:"+e+";";return t+="stroke:"+e+";"};var dat=dat||{};dat.gui=dat.gui||{},dat.utils=dat.utils||{},dat.controllers=dat.controllers||{},dat.dom=dat.dom||{},dat.color=dat.color||{},dat.utils.css=function(){return{load:function(e,t){var t=t||document,i=t.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,t.getElementsByTagName("head")[0].appendChild(i)},inject:function(e,t){var t=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e,t.getElementsByTagName("head")[0].appendChild(i)}}}(),dat.utils.common=function(){var e=Array.prototype.forEach,t=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(t.call(arguments,1),function(t){for(var i in t)this.isUndefined(t[i])||(e[i]=t[i])},this),e},defaults:function(e){return this.each(t.call(arguments,1),function(t){for(var i in t)this.isUndefined(e[i])&&(e[i]=t[i])},this),e},compose:function(){var e=t.call(arguments);return function(){for(var i=t.call(arguments),n=e.length-1;n>=0;n--)i=[e[n].apply(this,i)];return i[0]}},each:function(t,i,n){if(e&&t.forEach===e)t.forEach(i,n);else if(t.length===t.length+0)for(var r=0,o=t.length;o>r&&!(r in t&&i.call(n,t[r],r)===this.BREAK);r++);else for(r in t)if(i.call(n,t[r],r)===this.BREAK)break},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():t.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}(),dat.controllers.Controller=function(e){var t=function(e,t){this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onFinishChange=this.__onChange=void 0};return e.extend(t.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),t}(dat.utils.common),dat.dom.dom=function(e){function t(t){return"0"===t||e.isUndefined(t)?0:(t=t.match(n),e.isNull(t)?0:parseFloat(t[1]))}var i={};e.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(t,n){e.each(t,function(e){i[e]=n})});var n=/(\d+(\.\d+)?)px/,r={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(t,i,n){e.isUndefined(i)&&(i=!0),e.isUndefined(n)&&(n=!0),t.style.position="absolute",i&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,n,r,o){var r=r||{},s=i[n];if(!s)throw Error("Event type "+n+" not supported.");var a=document.createEvent(s);switch(s){case"MouseEvents":a.initMouseEvent(n,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,r.x||r.clientX||0,r.y||r.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":s=a.initKeyboardEvent||a.initKeyEvent,e.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(n,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:a.initEvent(n,r.bubbles||!1,r.cancelable||!0)}e.defaults(a,o),t.dispatchEvent(a)},bind:function(e,t,i,n){return e.addEventListener?e.addEventListener(t,i,n||!1):e.attachEvent&&e.attachEvent("on"+t,i),r},unbind:function(e,t,i,n){return e.removeEventListener?e.removeEventListener(t,i,n||!1):e.detachEvent&&e.detachEvent("on"+t,i),r},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);-1==i.indexOf(t)&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return r},removeClass:function(e,t){if(t){if(void 0!==e.className)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),n=i.indexOf(t);-1!=n&&(i.splice(n,1),e.className=i.join(" "))}}else e.className=void 0;return r},hasClass:function(e,t){return RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){return e=getComputedStyle(e),t(e["border-left-width"])+t(e["border-right-width"])+t(e["padding-left"])+t(e["padding-right"])+t(e.width)},getHeight:function(e){return e=getComputedStyle(e),t(e["border-top-width"])+t(e["border-bottom-width"])+t(e["padding-top"])+t(e["padding-bottom"])+t(e.height)},getOffset:function(e){var t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop;while(e=e.offsetParent);return t},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return r}(dat.utils.common),dat.controllers.OptionController=function(e,t,i){var n=function(e,r,o){n.superclass.call(this,e,r);var s=this;if(this.__select=document.createElement("select"),i.isArray(o)){var a={};i.each(o,function(e){a[e]=e}),o=a}i.each(o,function(e,t){var i=document.createElement("option");i.innerHTML=t,i.setAttribute("value",e),s.__select.appendChild(i)}),this.updateDisplay(),t.bind(this.__select,"change",function(){s.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)};return n.superclass=e,i.extend(n.prototype,e.prototype,{setValue:function(e){return e=n.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e},updateDisplay:function(){return this.__select.value=this.getValue(),n.superclass.prototype.updateDisplay.call(this)}}),n}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.NumberController=function(e,t){var i=function(e,n,r){i.superclass.call(this,e,n),r=r||{},this.__min=r.min,this.__max=r.max,this.__step=r.step,e=this.__impliedStep=t.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,e=""+e,this.__precision=e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0};return i.superclass=e,t.extend(i.prototype,e.prototype,{setValue:function(e){return void 0!==this.__min&&this.__min>e?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&0!=e%this.__step&&(e=Math.round(e/this.__step)*this.__step),i.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this}}),i}(dat.controllers.Controller,dat.utils.common),dat.controllers.NumberControllerBox=function(e,t,i){var n=function(e,r,o){function s(){var e=parseFloat(c.__input.value);i.isNaN(e)||c.setValue(e)}function a(e){var t=d-e.clientY;c.setValue(c.getValue()+t*c.__impliedStep),d=e.clientY}function l(){t.unbind(window,"mousemove",a),t.unbind(window,"mouseup",l)}this.__truncationSuspended=!1,n.superclass.call(this,e,r,o);var d,c=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"change",s),t.bind(this.__input,"blur",function(){s(),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}),t.bind(this.__input,"mousedown",function(e){t.bind(window,"mousemove",a),t.bind(window,"mouseup",l),d=e.clientY}),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&(c.__truncationSuspended=!0,this.blur(),c.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return n.superclass=e,i.extend(n.prototype,e.prototype,{updateDisplay:function(){var e,t=this.__input;if(this.__truncationSuspended)e=this.getValue();else{e=this.getValue();var i=Math.pow(10,this.__precision);e=Math.round(e*i)/i}return t.value=e,n.superclass.prototype.updateDisplay.call(this)}}),n}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common),dat.controllers.NumberControllerSlider=function(e,t,i,n,r){var o=function(e,i,n,r,s){function a(e){e.preventDefault();var i=t.getOffset(d.__background),n=t.getWidth(d.__background);return d.setValue(d.__min+(d.__max-d.__min)*((e.clientX-i.left)/(i.left+n-i.left))),!1}function l(){t.unbind(window,"mousemove",a),t.unbind(window,"mouseup",l),d.__onFinishChange&&d.__onFinishChange.call(d,d.getValue())}o.superclass.call(this,e,i,{min:n,max:r,step:s});var d=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),t.bind(this.__background,"mousedown",function(e){t.bind(window,"mousemove",a),t.bind(window,"mouseup",l),a(e)}),t.addClass(this.__background,"slider"),t.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return o.superclass=e,o.useDefaultStyles=function(){i.inject(r)},n.extend(o.prototype,e.prototype,{updateDisplay:function(){return this.__foreground.style.width=100*((this.getValue()-this.__min)/(this.__max-this.__min))+"%",o.superclass.prototype.updateDisplay.call(this)}}),o}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),dat.controllers.FunctionController=function(e,t,i){var n=function(e,i,r){n.superclass.call(this,e,i);var o=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===r?"Fire":r,t.bind(this.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),t.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return n.superclass=e,i.extend(n.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),n}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.BooleanController=function(e,t,i){var n=function(e,i){n.superclass.call(this,e,i);var r=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),t.bind(this.__checkbox,"change",function(){r.setValue(!r.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return n.superclass=e,i.extend(n.prototype,e.prototype,{setValue:function(e){return e=n.superclass.prototype.setValue.call(this,e),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,n.superclass.prototype.updateDisplay.call(this)}}),n}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.color.toString=function(e){return function(t){if(1==t.a||e.isUndefined(t.a)){for(t=t.hex.toString(16);6>t.length;)t="0"+t;return"#"+t}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}}(dat.utils.common),dat.color.interpret=function(e,t){var i,n,r=[{litmus:t.isString,conversions:{THREE_CHAR_HEX:{read:function(e){return e=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i),null===e?!1:{space:"HEX",hex:parseInt("0x"+(""+e[1])+(""+e[1])+(""+e[2])+(""+e[2])+(""+e[3])+(""+e[3]))}},write:e},SIX_CHAR_HEX:{read:function(e){return e=e.match(/^#([A-F0-9]{6})$/i),null===e?!1:{space:"HEX",hex:parseInt("0x"+(""+e[1]))}},write:e},CSS_RGB:{read:function(e){return e=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/),null===e?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:e},CSS_RGBA:{read:function(e){return e=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/),null===e?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:e}}},{litmus:t.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:t.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:t.isObject,conversions:{RGBA_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)&&t.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return t.isNumber(e.r)&&t.isNumber(e.g)&&t.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)&&t.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return t.isNumber(e.h)&&t.isNumber(e.s)&&t.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return function(){n=!1;var e=arguments.length>1?t.toArray(arguments):arguments[0];return t.each(r,function(r){return r.litmus(e)?(t.each(r.conversions,function(r,o){return i=r.read(e),n===!1&&i!==!1?(n=i,i.conversionName=o,i.conversion=r,t.BREAK):void 0}),t.BREAK):void 0}),n}}(dat.color.toString,dat.utils.common),dat.GUI=dat.gui.GUI=function(e,t,i,n,r,o,s,a,l,d,c,u,h,f,p){function m(e,t,i,o){if(void 0===t[i])throw Error("Object "+t+' has no property "'+i+'"');o.color?t=new c(t,i):(t=[t,i].concat(o.factoryArgs),t=n.apply(e,t)),o.before instanceof r&&(o.before=o.before.__li),b(e,t),f.addClass(t.domElement,"c"),i=document.createElement("span"),f.addClass(i,"property-name"),i.innerHTML=t.property;var s=document.createElement("div");return s.appendChild(i),s.appendChild(t.domElement),o=g(e,s,o.before),f.addClass(o,I.CLASS_CONTROLLER_ROW),f.addClass(o,typeof t.getValue()),_(e,o,t),e.__controllers.push(t),t}function g(e,t,i){var n=document.createElement("li");return t&&n.appendChild(t),i?e.__ul.insertBefore(n,params.before):e.__ul.appendChild(n),e.onResize(),n}function _(e,t,i){if(i.__li=t,i.__gui=e,p.extend(i,{options:function(t){return arguments.length>1?(i.remove(),m(e,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[p.toArray(arguments)]})):p.isArray(t)||p.isObject(t)?(i.remove(),m(e,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[t]})):void 0},name:function(e){return i.__li.firstElementChild.firstElementChild.innerHTML=e,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof l){var n=new a(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});p.each(["updateDisplay","onChange","onFinishChange"],function(e){var t=i[e],r=n[e];i[e]=n[e]=function(){var e=Array.prototype.slice.call(arguments);return t.apply(i,e),r.apply(n,e)}}),f.addClass(t,"has-slider"),i.domElement.insertBefore(n.domElement,i.domElement.firstElementChild)}else if(i instanceof a){var r=function(t){return p.isNumber(i.__min)&&p.isNumber(i.__max)?(i.remove(),m(e,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]})):t};i.min=p.compose(r,i.min),i.max=p.compose(r,i.max)}else i instanceof o?(f.bind(t,"click",function(){f.fakeEvent(i.__checkbox,"click")}),f.bind(i.__checkbox,"click",function(e){e.stopPropagation()})):i instanceof s?(f.bind(t,"click",function(){f.fakeEvent(i.__button,"click")}),f.bind(t,"mouseover",function(){f.addClass(i.__button,"hover")}),f.bind(t,"mouseout",function(){f.removeClass(i.__button,"hover")})):i instanceof c&&(f.addClass(t,"color"),i.updateDisplay=p.compose(function(e){return t.style.borderLeftColor=""+i.__color,e},i.updateDisplay),i.updateDisplay());i.setValue=p.compose(function(t){return e.getRoot().__preset_select&&i.isModified()&&C(e.getRoot(),!0),t},i.setValue)}function b(e,t){var i=e.getRoot(),n=i.__rememberedObjects.indexOf(t.object);if(-1!=n){var r=i.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},i.__rememberedObjectIndecesToControllers[n]=r),r[t.property]=t,i.load&&i.load.remembered){if(i=i.load.remembered,i[e.preset])i=i[e.preset];else{if(!i[A])return;i=i[A]}i[n]&&void 0!==i[n][t.property]&&(n=i[n][t.property],t.initialValue=n,t.setValue(n))}}}function v(e){var t=e.__save_row=document.createElement("li");f.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),f.addClass(t,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",f.addClass(i,"button gears");var n=document.createElement("span");n.innerHTML="Save",f.addClass(n,"button"),f.addClass(n,"save");var r=document.createElement("span");r.innerHTML="New",f.addClass(r,"button"),f.addClass(r,"save-as");var o=document.createElement("span");o.innerHTML="Revert",f.addClass(o,"button"),f.addClass(o,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?p.each(e.load.remembered,function(t,i){w(e,i,i==e.preset)}):w(e,A,!1),f.bind(s,"change",function(){for(var t=0;e.__preset_select.length>t;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(i),t.appendChild(n),t.appendChild(r),t.appendChild(o),F){var t=document.getElementById("dg-save-locally"),a=document.getElementById("dg-local-explain");t.style.display="block",t=document.getElementById("dg-local-storage"),"true"===localStorage.getItem(document.location.href+".isLocal")&&t.setAttribute("checked","checked");var l=function(){a.style.display=e.useLocalStorage?"block":"none"};l(),f.bind(t,"change",function(){e.useLocalStorage=!e.useLocalStorage,l()})}var d=document.getElementById("dg-new-constructor");f.bind(d,"keydown",function(e){e.metaKey&&(67===e.which||67==e.keyCode)&&T.hide()}),f.bind(i,"click",function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),T.show(),d.focus(),d.select()}),f.bind(n,"click",function(){e.save()}),f.bind(r,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),f.bind(o,"click",function(){e.revert()})}function y(e){function t(t){return t.preventDefault(),r=t.clientX,f.addClass(e.__closeButton,I.CLASS_DRAG),f.bind(window,"mousemove",i),f.bind(window,"mouseup",n),!1}function i(t){return t.preventDefault(),e.width+=r-t.clientX,e.onResize(),r=t.clientX,!1}function n(){f.removeClass(e.__closeButton,I.CLASS_DRAG),f.unbind(window,"mousemove",i),f.unbind(window,"mouseup",n)}e.__resize_handle=document.createElement("div"),p.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var r;f.bind(e.__resize_handle,"mousedown",t),f.bind(e.__closeButton,"mousedown",t),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function S(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function x(e,t){var i={};return p.each(e.__rememberedObjects,function(n,r){var o={};p.each(e.__rememberedObjectIndecesToControllers[r],function(e,i){o[i]=t?e.initialValue:e.getValue()}),i[r]=o}),i}function w(e,t,i){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),i&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function C(e,t){var i=e.__preset_select[e.__preset_select.selectedIndex];i.innerHTML=t?i.value+"*":i.value}function E(e){0!=e.length&&u(function(){E(e)}),p.each(e,function(e){e.updateDisplay()})}e.inject(i);var F,A="Default";try{F="localStorage"in window&&null!==window.localStorage}catch(k){F=!1}var T,R,L=!0,N=!1,M=[],I=function(e){function t(){localStorage.setItem(document.location.href+".gui",JSON.stringify(n.getSaveObject()))}function i(){var e=n.getRoot();e.width+=1,p.defer(function(){e.width-=1})}var n=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),f.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=p.defaults(e,{autoPlace:!0,width:I.DEFAULT_WIDTH}),e=p.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),p.isUndefined(e.load)?e.load={preset:A}:e.preset&&(e.load.preset=e.preset),p.isUndefined(e.parent)&&e.hideable&&M.push(this),e.resizable=p.isUndefined(e.parent)&&e.resizable,e.autoPlace&&p.isUndefined(e.scrollable)&&(e.scrollable=!0);var r=F&&"true"===localStorage.getItem(document.location.href+".isLocal");if(Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return n.parent?n.getRoot().preset:e.load.preset},set:function(t){for(n.parent?n.getRoot().preset=t:e.load.preset=t,t=0;this.__preset_select.length>t;t++)this.__preset_select[t].value==this.preset&&(this.__preset_select.selectedIndex=t);n.revert()}},width:{get:function(){return e.width},set:function(t){e.width=t,S(n,t)}},name:{get:function(){return e.name},set:function(t){e.name=t,s&&(s.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(t){e.closed=t,e.closed?f.addClass(n.__ul,I.CLASS_CLOSED):f.removeClass(n.__ul,I.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?I.TEXT_OPEN:I.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return r},set:function(e){F&&((r=e)?f.bind(window,"unload",t):f.unbind(window,"unload",t),localStorage.setItem(document.location.href+".isLocal",e))}}}),p.isUndefined(e.parent)){if(e.closed=!1,f.addClass(this.domElement,I.CLASS_MAIN),f.makeSelectable(this.domElement,!1),F&&r){n.useLocalStorage=!0;var o=localStorage.getItem(document.location.href+".gui");o&&(e.load=JSON.parse(o))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=I.TEXT_CLOSED,f.addClass(this.__closeButton,I.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),f.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===e.closed&&(e.closed=!0);var s=document.createTextNode(e.name);f.addClass(s,"controller-name"),o=g(n,s),f.addClass(this.__ul,I.CLASS_CLOSED),f.addClass(o,"title"),f.bind(o,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),e.closed||(this.closed=!1)}e.autoPlace&&(p.isUndefined(e.parent)&&(L&&(R=document.createElement("div"),f.addClass(R,"dg"),f.addClass(R,I.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(R),L=!1),R.appendChild(this.domElement),f.addClass(this.domElement,I.CLASS_AUTO_PLACE)),this.parent||S(n,e.width)),f.bind(window,"resize",function(){n.onResize()}),f.bind(this.__ul,"webkitTransitionEnd",function(){n.onResize()}),f.bind(this.__ul,"transitionend",function(){n.onResize()}),f.bind(this.__ul,"oTransitionEnd",function(){n.onResize()}),this.onResize(),e.resizable&&y(this),n.getRoot(),e.parent||i()};return I.toggleHide=function(){N=!N,p.each(M,function(e){e.domElement.style.zIndex=N?-999:999,e.domElement.style.opacity=N?0:1})},I.CLASS_AUTO_PLACE="a",I.CLASS_AUTO_PLACE_CONTAINER="ac",I.CLASS_MAIN="main",I.CLASS_CONTROLLER_ROW="cr",I.CLASS_TOO_TALL="taller-than-window",I.CLASS_CLOSED="closed",I.CLASS_CLOSE_BUTTON="close-button",I.CLASS_DRAG="drag",I.DEFAULT_WIDTH=245,I.TEXT_CLOSED="Close Controls",I.TEXT_OPEN="Open Controls",f.bind(window,"keydown",function(e){"text"!==document.activeElement.type&&(72===e.which||72==e.keyCode)&&I.toggleHide()},!1),p.extend(I.prototype,{add:function(e,t){return m(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return m(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var t=this;p.defer(function(){t.onResize()})},destroy:function(){this.autoPlace&&R.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};return t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]),t=new I(t),this.__folders[e]=t,e=g(this,t.domElement),f.addClass(e,"folder"),t},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=f.getOffset(e.__ul).top,i=0;p.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(i+=f.getHeight(t))}),i>window.innerHeight-t-20?(f.addClass(e.domElement,I.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(f.removeClass(e.domElement,I.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&p.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){if(p.isUndefined(T)&&(T=new h,T.domElement.innerHTML=t),this.parent)throw Error("You can only call remember on a top level GUI.");var e=this;p.each(Array.prototype.slice.call(arguments),function(t){0==e.__rememberedObjects.length&&v(e),-1==e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&S(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=x(this)),e.folders={},p.each(this.__folders,function(t,i){e.folders[i]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=x(this),C(this,!1)},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[A]=x(this,!0)),this.load.remembered[e]=x(this),this.preset=e,w(this,e,!0)},revert:function(e){p.each(this.__controllers,function(t){this.getRoot().load.remembered?b(e||this.getRoot(),t):t.setValue(t.initialValue)},this),p.each(this.__folders,function(e){e.revert(e)}),e||C(this.getRoot(),!1)},listen:function(e){var t=0==this.__listening.length;this.__listening.push(e),t&&E(this.__listening)}}),I}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",dat.controllers.factory=function(e,t,i,n,r,o,s){return function(a,l,d,c){var u=a[l];
return s.isArray(d)||s.isObject(d)?new e(a,l,d):s.isNumber(u)?s.isNumber(d)&&s.isNumber(c)?new i(a,l,d,c):new t(a,l,{min:d,max:c}):s.isString(u)?new n(a,l):s.isFunction(u)?new r(a,l,""):s.isBoolean(u)?new o(a,l):void 0}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(e,t,i){var n=function(e,i){function r(){o.setValue(o.__input.value)}n.superclass.call(this,e,i);var o=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),t.bind(this.__input,"keyup",r),t.bind(this.__input,"change",r),t.bind(this.__input,"blur",function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}),t.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return n.superclass=e,i.extend(n.prototype,e.prototype,{updateDisplay:function(){return t.isActive(this.__input)||(this.__input.value=this.getValue()),n.superclass.prototype.updateDisplay.call(this)}}),n}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(e,t,i,n,r){function o(e,t,i,n){e.style.background="",r.each(l,function(r){e.style.cssText+="background: "+r+"linear-gradient("+t+", "+i+" 0%, "+n+" 100%); "})}function s(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var a=function(e,l){function d(e){f(e),t.bind(window,"mousemove",f),t.bind(window,"mouseup",c)}function c(){t.unbind(window,"mousemove",f),t.unbind(window,"mouseup",c)}function u(){var e=n(this.value);e!==!1?(m.__color.__state=e,m.setValue(m.__color.toOriginal())):this.value=""+m.__color}function h(){t.unbind(window,"mousemove",p),t.unbind(window,"mouseup",h)}function f(e){e.preventDefault();var i=t.getWidth(m.__saturation_field),n=t.getOffset(m.__saturation_field),r=(e.clientX-n.left+document.body.scrollLeft)/i,e=1-(e.clientY-n.top+document.body.scrollTop)/i;return e>1?e=1:0>e&&(e=0),r>1?r=1:0>r&&(r=0),m.__color.v=e,m.__color.s=r,m.setValue(m.__color.toOriginal()),!1}function p(e){e.preventDefault();var i=t.getHeight(m.__hue_field),n=t.getOffset(m.__hue_field),e=1-(e.clientY-n.top+document.body.scrollTop)/i;return e>1?e=1:0>e&&(e=0),m.__color.h=360*e,m.setValue(m.__color.toOriginal()),!1}a.superclass.call(this,e,l),this.__color=new i(this.getValue()),this.__temp=new i(0);var m=this;this.domElement=document.createElement("div"),t.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",t.bind(this.__input,"keydown",function(e){13===e.keyCode&&u.call(this)}),t.bind(this.__input,"blur",u),t.bind(this.__selector,"mousedown",function(){t.addClass(this,"drag").bind(window,"mouseup",function(){t.removeClass(m.__selector,"drag")})});var g=document.createElement("div");r.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),r.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),r.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),r.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),r.extend(g.style,{width:"100%",height:"100%",background:"none"}),o(g,"top","rgba(0,0,0,0)","#000"),r.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),s(this.__hue_field),r.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),t.bind(this.__saturation_field,"mousedown",d),t.bind(this.__field_knob,"mousedown",d),t.bind(this.__hue_field,"mousedown",function(e){p(e),t.bind(window,"mousemove",p),t.bind(window,"mouseup",h)}),this.__saturation_field.appendChild(g),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};a.superclass=e,r.extend(a.prototype,e.prototype,{updateDisplay:function(){var e=n(this.getValue());if(e!==!1){var t=!1;r.each(i.COMPONENTS,function(i){return r.isUndefined(e[i])||r.isUndefined(this.__color.__state[i])||e[i]===this.__color.__state[i]?void 0:(t=!0,{})},this),t&&r.extend(this.__color.__state,e)}r.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=.5>this.__color.v||this.__color.s>.5?255:0,a=255-s;r.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:""+this.__temp,border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,o(this.__saturation_field,"left","#fff",""+this.__temp),r.extend(this.__input.style,{backgroundColor:this.__input.value=""+this.__color,color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}});var l=["-moz-","-o-","-webkit-","-ms-",""];return a}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(e,t,i,n){function r(e,t,i){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(s(this,t,i),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(s(this,t,i),this.__state.space="RGB"),this.__state[t]=e}})}function o(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(a(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(a(this),this.__state.space="HSV"),this.__state[t]=e}})}function s(e,i,r){if("HEX"===e.__state.space)e.__state[i]=t.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw"Corrupted color state";n.extend(e.__state,t.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function a(e){var i=t.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:i.s,v:i.v}),n.isNaN(i.h)?n.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=i.h}var l=function(){if(this.__state=e.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return l.COMPONENTS="r,g,b,h,s,v,hex,a".split(","),n.extend(l.prototype,{toString:function(){return i(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),r(l.prototype,"r",2),r(l.prototype,"g",1),r(l.prototype,"b",0),o(l.prototype,"h"),o(l.prototype,"s"),o(l.prototype,"v"),Object.defineProperty(l.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(l.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=t.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),l}(dat.color.interpret,dat.color.math=function(){var e;return{hsv_to_rgb:function(e,t,i){var n=e/60-Math.floor(e/60),r=i*(1-t),o=i*(1-n*t),t=i*(1-(1-n)*t),e=[[i,t,r],[o,i,r],[r,i,t],[r,o,i],[t,r,i],[i,r,o]][Math.floor(e/60)%6];return{r:255*e[0],g:255*e[1],b:255*e[2]}},rgb_to_hsv:function(e,t,i){var n=Math.min(e,t,i),r=Math.max(e,t,i),n=r-n;return 0==r?{h:0/0,s:0,v:0}:(e=e==r?(t-i)/n:t==r?2+(i-e)/n:4+(e-t)/n,e/=6,0>e&&(e+=1),{h:360*e,s:n/r,v:r/255})},rgb_to_hex:function(e,t,i){return e=this.hex_with_component(0,2,e),e=this.hex_with_component(e,1,t),e=this.hex_with_component(e,0,i)},component_from_hex:function(e,t){return 255&e>>8*t},hex_with_component:function(t,i,n){return n<<(e=8*i)|t&~(255<<e)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),dat.dom.CenteredDiv=function(e,t){var i=function(){this.backgroundElement=document.createElement("div"),t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var i=this;e.bind(this.backgroundElement,"click",function(){i.hide()})};return i.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),t.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},i.prototype.hide=function(){var t=this,i=function(){t.domElement.style.display="none",t.backgroundElement.style.display="none",e.unbind(t.domElement,"webkitTransitionEnd",i),e.unbind(t.domElement,"transitionend",i),e.unbind(t.domElement,"oTransitionEnd",i)};e.bind(this.domElement,"webkitTransitionEnd",i),e.bind(this.domElement,"transitionend",i),e.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},i.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},i}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);var imported=document.createElement("script");imported.src="js/gif.js",document.head.appendChild(imported);var frames=[],transparency=null,delay=null,disposalMethod=null,lastDisposalMethod=null,frame=null,curFrameNum=0,sample=null,numSamples=0,quadtree,mood=null,scale,storedPoints=[],resetTimeout=-1,uiTimeout=-1,distance=function(e,t){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},img={preview:document.querySelector("#preview"),canvas:document.createElement("canvas"),context:null,grayscale:null,loaded:!1};document.querySelector("#gifcanvas").appendChild(img.canvas),img.context=img.canvas.getContext("2d");var playGIF=function(e){console.log("Playing gif: ",e.getAttribute("src"));var t,i,n=null,r=!0,o=!0,s=function(){transparency=null,delay=null,lastDisposalMethod=disposalMethod,disposalMethod=null,frame=null},a=function(){try{parseGIF(t,x)}catch(e){h("parse")}},l=function(){console.log("doGet()");var i=new XMLHttpRequest;i.overrideMimeType("text/plain; charset=x-user-defined"),i.onload=function(){console.log("Retrieving gif data..."),console.log("h.status: ",i.status),i.status>=200&&400>i.status?(t=new Stream(i.responseText),setTimeout(a,0),null!=img&&(img.src=e.getAttribute("src"))):console.log("reached giphy, but API returned an error")},i.onprogress=u,i.onerror=function(){h("xhr")},console.log("gif: ",e.getAttribute("src")),i.open("GET",e.getAttribute("src"),!0),i.send()},d=function(e){A.innerHTML=e},c=function(e,t,i,n){if(A.style.visibility=t===i?"":"visible",n){var r=Math.min(E.height>>3,E.height),o=E.height-r>>1;E.height+r>>1;var s=t/i*E.width;F.fillStyle="rgba(255,160,122,0.5)",F.fillRect(s,o,E.width-s,r),F.fillStyle="rgba(0,128,128,0.5)",F.fillRect(0,o,t/i*E.width,r)}d(e+" "+Math.floor(100*(t/i))+"%")},u=function(){},h=function(t){var r=function(){F.fillStyle="black",F.fillRect(0,0,i.width,i.height),F.strokeStyle="red",F.lineWidth=3,F.moveTo(0,0),F.lineTo(i.width,i.height),F.moveTo(0,i.height),F.lineTo(i.width,0),F.stroke()};n=t,i={width:e.width,height:e.height},frames=[],r(),setTimeout(_,0)},f=function(e){i=e,E.width=i.width,E.height=i.height,C.style.width=i.width+"px",A.style.minWidth=i.width+"px",k.width=i.width,k.height=i.height},p=function(e){m(),s(),transparency=e.transparencyGiven?e.transparencyIndex:null,delay=e.delayTime,disposalMethod=e.disposalMethod},m=function(){frame&&frames.push({data:frame.getImageData(0,0,i.width,i.height),delay:delay})},g=function(e){frame||(frame=k.getContext("2d"));var t=e.lctFlag?e.lct:i.gct,n=frame.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,i){transparency!==e?(n.data[4*i+0]=t[e][0],n.data[4*i+1]=t[e][1],n.data[4*i+2]=t[e][2],n.data[4*i+3]=255):(2===lastDisposalMethod||3===lastDisposalMethod)&&(n.data[4*i+3]=0)}),frame.putImageData(n,e.leftPos,e.topPos),F.putImageData(n,e.leftPos,e.topPos);var r=F.getImageData(0,0,E.width,E.height);e.grayscale=new jsfeat.matrix_t(E.width,E.height,jsfeat.U8_t|jsfeat.C1_t),jsfeat.imgproc.grayscale(r.data,E.width,E.height,e.grayscale),e.loaded=!0},_=function(){var t,s,a=-1,l=!1,d=!1,c=function(e){a=(a+e+frames.length)%frames.length,s.value=a+1,t.value=frames[a].delay,h()},u=function(){var e=!1,t=function(){if(e=r){c(o?1:-1);var i=1*frames[a].delay;i||(i=1),setTimeout(t,i)}};return function(){e||setTimeout(t,0)}}(),h=function(){F.putImageData(frames[a].data,0,0),curFrameNum=s.value,img.loaded=!0,window.updateRenderer&&window.updateRenderer()},f=function(){var i="&#9654;",f="&#9664;",p="&#10073;",m="&rarr;",g="&larr;",_="&#10006;",v="&#9675;",y="&#8857;",S="&nearr;",x=i,w=p+p,F=f,k=f+p,T=p+i,R="i",L=g,N=m,M=_,I=y,O=v,V=S,P=function(e,t,i){var n=document.createElement(e);t&&(n.className="jsgif_"+t);for(var r in i)n[r]=i[r];return n},D=P("div","simple_tools"),B=P("button","rev"),H=P("button","show_info"),G=P("button","prev"),z=P("button","play_pause"),j=P("button","next"),U=P("button","pin"),W=P("button","close"),X=P("div","info_tools");s=P("input","cur_frame",{type:"text"}),t=P("input","delay_info",{type:"text"});var Y=function(){r?(z.innerHTML=w,z.title="Pause",G.style.visibility="hidden",j.style.visibility="hidden"):(z.innerHTML=o?x:F,z.title="Play",G.style.visibility="",j.style.visibility=""),A.style.visibility=d?"visible":"",X.style.display=l?"":"none",H.innerHTML=R,H.title="Show info/more tools",B.innerHTML=o?L:N,B.title=o?"Reverse":"Un-reverse",G.innerHTML=k,G.title="Previous frame",j.innerHTML=T,j.title="Next frame",U.innerHTML=d?O:I,U.title=d?"Unpin":"Pin",W.innerHTML=M,W.title="Close jsgif and go back to original image",s.disabled=r,t.disabled=r,A.innerHTML="",D.innerHTML="",X.innerHTML="";var i=function(e){return document.createTextNode(e)};if(2>frames.length){if("xhr"==n){A.appendChild(i("Load failed; cross-domain? "));var a=P("button","popup");a.addEventListener("click",function(){window.open(e.src)}),a.innerHTML=V,a.title="Click to open GIF in new window; try running jsgif there instead",A.appendChild(a)}else"parse"==n&&A.appendChild(i("Parse failed "));return A.appendChild(W),void 0}var c=function(e,t){e.innerHTML="",t.forEach(function(t){e.appendChild(t)})},u=o?[H,B,G,z,j,U,W]:[H,B,j,z,G,U,W];c(A,[D,X]),c(D,u),c(X,[i(" frame: "),s,i(" / "),i(frames.length),i(" (delay: "),t,i(")")])},q=function(){o=!o,Y(),B.focus()},K=function(){c(1)},$=function(){c(-1)},J=function(){r=!r,Y(),z.focus(),u()},Q=function(){var e=+s.value;isNaN(e)||1>e||e>frames.length?s.value=a+1:(a=e-1,h())},Z=function(){var e=+t.value;isNaN(e)||(frames[a].delay=e)},et=function(){l=!l,Y(),H.focus()},tt=function(){d=!d,Y(),U.focus()};H.addEventListener("click",et,!1),B.addEventListener("click",q,!1),s.addEventListener("change",Q,!1),G.addEventListener("click",$,!1),z.addEventListener("click",J,!1),j.addEventListener("click",K,!1),U.addEventListener("click",tt,!1),W.addEventListener("click",b,!1),t.addEventListener("change",Z,!1),E.addEventListener("click",J,!1),C.addEventListener("click",function(e){e.preventDefault()},!1),Y()};return function(){setTimeout(f,0),n||(E.width=i.width,E.height=i.height,u())}}(),b=function(){r=!1,w.insertBefore(e,C),w.removeChild(C)},v=function(e){c("Decoding (frame "+(frames.length+1)+")...",t.pos,t.data.length,e)},y=function(){},S=function(e,t){return function(i){e(i),v(t)}},x={hdr:S(f),gce:S(p),com:S(y),app:{NETSCAPE:S(y)},img:S(g,!0),eof:function(){m(),v(!1),console.log("Playing gif."),_()}},w=e.parentNode,C=document.createElement("div");C.setAttribute("id","tmp");var E=img.canvas,F=img.context,A=document.createElement("div");A.setAttribute("id","tmp");var k=document.createElement("canvas");k.setAttribute("id","tmp"),E.width=e.width,E.height=e.height,A.style.minWidth=e.width+"px",C.className="jsgif",A.className="jsgif_toolbar",d("Loading..."),l()};(function(){function e(){t(),n(),r(),s(),h(),a(C.offsetWidth,C.offsetHeight),d()}function t(){R=new FSS.WebGLRenderer,L=new FSS.CanvasRenderer,N=new FSS.SVGRenderer,i(x.renderer)}function i(e){switch(E&&I.removeChild(E.element),e){case v:E=R;break;case y:E=L;break;case S:E=N}E.setSize(C.offsetWidth,C.offsetHeight),I.appendChild(E.element)}function n(){F=new FSS.Scene}function r(){F.remove(A),E.clear(),k=new FSS.Plane(_.width*E.width,_.height*E.height,_.slices),T=new FSS.Material(_.ambient,_.diffuse),A=new FSS.Mesh(k,T),F.add(A);var e,t;for(e=k.vertices.length-1;e>=0;e--)t=k.vertices[e],t.depth=Math.randomInRange(0,_.maxdepth/10),t.anchor=FSS.Vector3.clone(t.position)}function o(e,t,i,n,r){e=e!==void 0?e:b.ambient,t=t!==void 0?t:b.diffuse,i=i!==void 0?i:b.xPos,n=n!==void 0?n:b.yPos,r=r!==void 0?r:b.zOffset,E.clear(),light=new FSS.Light(e,t),light.ambientHex=light.ambient.format(),light.diffuseHex=light.diffuse.format(),light.setPosition(i,n,r),F.add(light),b.diffuse=t,b.proxy=light,b.pickedup=!0,b.currIndex++}function s(){for(var e=1,t=e-1;t>=0;t--)o(),b.count++}function a(e,t){E.setSize(e,t),FSS.Vector3.set(w,E.halfWidth,E.halfHeight),r()}function d(){c(g),u(),requestAnimationFrame(d),g-=.5*g,0>g&&(g=0)}function c(e){var t,i,n=_.depth/100;for(t=k.vertices.length-1;t>=0;t--){i=k.vertices[t],FSS.Vector3.set(i.position,1,1,i.depth*n),FSS.Vector3.add(i.position,i.anchor);var r=Math.random()*e,o=-Math.random()*e,s=FSS.Vector3.create(r,o,0);FSS.Vector3.add(i.position,s)}k.dirty=!0}function u(){E.render(F)}function h(){window.addEventListener("resize",p),C.addEventListener("mousemove",m)}function f(e){var t=document.getElementById(e);t.style.display="block"==t.style.display?"none":"block"}function p(){a(C.offsetWidth,C.offsetHeight),u()}function m(e){b.pickedup&&(b.xPos=e.x-E.width/2,b.yPos=E.height/2-e.y,b.proxy.setPosition(b.xPos,b.yPos,b.proxy.position[2]))}var g=0,_={width:1.2,height:1.2,slices:500,depth:0,maxdepth:200,ambient:"#000000",diffuse:"#000000"},b={count:0,xPos:0,yPos:200,zOffset:100,ambient:"#FFFFFF",diffuse:"#FFFFFF",pickedup:!0,proxy:!1,currIndex:0,randomize:function(){var e,t,i,n=Math.floor(3*Math.random())+1;for(1==n&&(_.depth=0),2==n&&(_.depth=Math.randomInRange(0,150)),3==n&&(_.depth=Math.randomInRange(150,200)),l=F.lights.length-1;l>=0;l--){e=Math.randomInRange(-A.geometry.width/2,A.geometry.width/2),t=Math.randomInRange(-A.geometry.height/2,A.geometry.height/2),i=F.lights.length>2?Math.randomInRange(10,80):Math.randomInRange(10,100),light=F.lights[l],FSS.Vector3.set(light.position,e,t,i);var r="#FFFFFF",o="#FFFFFF";light.diffuse.set(r),light.diffuseHex=light.diffuse.format(),light.ambient.set(o),light.ambientHex=light.ambient.format(),b.xPos=e,b.yPos=t,b.zOffset=i,b.diffuse=r,b.ambient=o,M.__folders.Light.__controllers[1].updateDisplay(),M.__folders.Light.__controllers[2].updateDisplay()}}},v="webgl",y="canvas",S="svg",x={renderer:y},w=FSS.Vector3.create(),C=document.getElementById("container");document.getElementById("controls");var E,F,A,k,T,R,L,N,M,I=document.getElementById("output");Mousetrap.bind("H",function(){f("controls"),f("links")}),Mousetrap.bind("enter",function(){b.count++,o()}),Mousetrap.bind("space",function(){g+=5,A.update(E,F.lights,!0)}),e(),initGif(),window.updateRenderer=function(){A.update(E,F.lights,!0)},console.log("window.updateRenderer=",window.updateRenderer)})();